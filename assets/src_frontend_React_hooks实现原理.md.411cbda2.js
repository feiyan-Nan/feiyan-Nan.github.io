import{_ as n,c as s,o as a,d as t}from"./app.7277c524.js";const h='{"title":"react hooks \u5B9E\u73B0\u539F\u7406","description":"","frontmatter":{},"headers":[{"level":2,"title":"useState\u539F\u7406","slug":"usestate\u539F\u7406"},{"level":2,"title":"useCallback (\u51CF\u5C11\u6E32\u67D3\u6B21\u6570)","slug":"usecallback-\u51CF\u5C11\u6E32\u67D3\u6B21\u6570"},{"level":2,"title":"useMemo (\u51CF\u5C11\u6E32\u67D3\u6B21\u6570)","slug":"usememo-\u51CF\u5C11\u6E32\u67D3\u6B21\u6570"},{"level":2,"title":"useEffect","slug":"useeffect"},{"level":2,"title":"useLayoutEffect","slug":"uselayouteffect"},{"level":2,"title":"useContext","slug":"usecontext"},{"level":2,"title":"useReducer","slug":"usereducer"}],"relativePath":"src/frontend/React/hooks\u5B9E\u73B0\u539F\u7406.md","lastUpdated":1649840977536}',p={},o=t(`<h1 id="react-hooks-\u5B9E\u73B0\u539F\u7406" tabindex="-1">react hooks \u5B9E\u73B0\u539F\u7406 <a class="header-anchor" href="#react-hooks-\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a></h1><h2 id="usestate\u539F\u7406" tabindex="-1">useState\u539F\u7406 <a class="header-anchor" href="#usestate\u539F\u7406" aria-hidden="true">#</a></h2><ol><li><h5 id="\u6838\u5FC3\u601D\u60F3\uFF1A\u5B9A\u4E49\u4E00\u4E2A\u53D8\u91CF-\u5F53\u6E32\u67D3\u7EC4\u4EF6\u7684\u65F6\u5019\u62FF\u5230\u4E0A\u4E2A\u72B6\u6001" tabindex="-1">\u6838\u5FC3\u601D\u60F3\uFF1A\u5B9A\u4E49\u4E00\u4E2A\u53D8\u91CF \u5F53\u6E32\u67D3\u7EC4\u4EF6\u7684\u65F6\u5019\u62FF\u5230\u4E0A\u4E2A\u72B6\u6001 <a class="header-anchor" href="#\u6838\u5FC3\u601D\u60F3\uFF1A\u5B9A\u4E49\u4E00\u4E2A\u53D8\u91CF-\u5F53\u6E32\u67D3\u7EC4\u4EF6\u7684\u65F6\u5019\u62FF\u5230\u4E0A\u4E2A\u72B6\u6001" aria-hidden="true">#</a></h5><div class="language-js"><pre><code><span class="token keyword">let</span> lastState <span class="token comment">//\u4E0A\u4E00\u4E2A\u72B6\u6001</span>
<span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    lastState <span class="token operator">=</span> lastState <span class="token operator">||</span> initialState
    <span class="token keyword">function</span> <span class="token function">setState</span> <span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        lastState <span class="token operator">=</span> newState
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u6BCF\u6B21\u8C03\u7528setState\u5C31\u4F1A\u91CD\u65B0\u5237\u65B0\u6E32\u67D3\u7EC4\u4EF6</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>lastState<span class="token punctuation">,</span>setState<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><h5 id="\u5F53\u4F7F\u7528\u591A\u4E2Astate\u7684\u65F6\u5019-\u53EF\u4EE5\u7528\u6570\u7EC4\u50A8\u5B58\u53D8\u91CF" tabindex="-1">\u5F53\u4F7F\u7528\u591A\u4E2Astate\u7684\u65F6\u5019 \u53EF\u4EE5\u7528\u6570\u7EC4\u50A8\u5B58\u53D8\u91CF <a class="header-anchor" href="#\u5F53\u4F7F\u7528\u591A\u4E2Astate\u7684\u65F6\u5019-\u53EF\u4EE5\u7528\u6570\u7EC4\u50A8\u5B58\u53D8\u91CF" aria-hidden="true">#</a></h5><div class="language-js"><pre><code><span class="token keyword">let</span> hookStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//\u4FDD\u5B58\u72B6\u6001\u7684\u6570\u7EC4</span>
<span class="token keyword">let</span> hookIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//\u72B6\u6001\u7D22\u5F15</span>
<span class="token keyword">function</span> <span class="token function">useState</span> <span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">||</span> initialState
    <span class="token comment">// \u5229\u7528\u95ED\u5305\u7279\u6027 setState\u6267\u884C \u4E0D\u4F1A\u6539\u53D8currentIndex</span>
    <span class="token keyword">let</span> currentIndex <span class="token operator">=</span> hookIndex 
    <span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> newState
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span>setState<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u5FC5\u987B\u91CD\u7F6E\u4E3A0 \u5426\u5219hookIndex\u7684\u72B6\u6001\u4F1A\u4E00\u76F4\u7D2F\u52A0 \u627E\u4E0D\u5230\u7D22\u5F15\u9879</span>
    hookIndex <span class="token operator">=</span><span class="token number">0</span> 
    <span class="token comment">//\u6E32\u67D3react dom</span>
    ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElmentById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div></li></ol><h2 id="usecallback-\u51CF\u5C11\u6E32\u67D3\u6B21\u6570" tabindex="-1">useCallback (\u51CF\u5C11\u6E32\u67D3\u6B21\u6570) <a class="header-anchor" href="#usecallback-\u51CF\u5C11\u6E32\u67D3\u6B21\u6570" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> hookStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//\u4FDD\u5B58\u72B6\u6001\u7684\u6570\u7EC4</span>
<span class="token keyword">let</span> hookIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//\u72B6\u6001\u7D22\u5F15</span>
<span class="token keyword">function</span> <span class="token function">useCallback</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span>dependencies</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u8BF4\u660E\u4E0D\u662F\u7B2C\u4E00\u6B21  </span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">[</span>lastCallback<span class="token punctuation">,</span>lastDependencies<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>
        <span class="token keyword">let</span> same <span class="token operator">=</span> dependencies<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>item<span class="token operator">===</span>lastDependencies<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span><span class="token punctuation">{</span>
            hookIndex<span class="token operator">++</span>
               <span class="token keyword">return</span> lastCallback
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u53EA\u8981\u6709\u4E00\u4E2A\u53D8\u91CF\u4F9D\u8D56\u53D8\u5316</span>
            hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span>dependencies<span class="token punctuation">]</span>
            <span class="token keyword">return</span> callback
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u8BF4\u660E\u662F\u7B2C\u4E00\u6B21\u6E32\u67D3</span>
        hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span>dependencies<span class="token punctuation">]</span>
        <span class="token keyword">return</span> callback
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u5FC5\u987B\u91CD\u7F6E\u4E3A0 \u5426\u5219hookIndex\u7684\u72B6\u6001\u4F1A\u4E00\u76F4\u7D2F\u52A0 \u627E\u4E0D\u5230\u7D22\u5F15\u9879</span>
    hookIndex <span class="token operator">=</span><span class="token number">0</span> 
    <span class="token comment">//\u6E32\u67D3react dom</span>
    ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElmentById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="usememo-\u51CF\u5C11\u6E32\u67D3\u6B21\u6570" tabindex="-1">useMemo (\u51CF\u5C11\u6E32\u67D3\u6B21\u6570) <a class="header-anchor" href="#usememo-\u51CF\u5C11\u6E32\u67D3\u6B21\u6570" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> hookStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//\u4FDD\u5B58\u72B6\u6001\u7684\u6570\u7EC4</span>
<span class="token keyword">let</span> hookIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//\u72B6\u6001\u7D22\u5F15</span>
<span class="token keyword">function</span> <span class="token function">useCallback</span> <span class="token punctuation">(</span><span class="token parameter">factory<span class="token punctuation">,</span>dependencies</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u8BF4\u660E\u4E0D\u662F\u7B2C\u4E00\u6B21  </span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">[</span>lastMemo<span class="token punctuation">,</span>lastDependencies<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>
        <span class="token keyword">let</span> same <span class="token operator">=</span> dependencies<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>item<span class="token operator">===</span>lastDependencies<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span><span class="token punctuation">{</span>
            hookIndex<span class="token operator">++</span>
               <span class="token keyword">return</span> lastMemo
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u53EA\u8981\u6709\u4E00\u4E2A\u53D8\u91CF\u4F9D\u8D56\u53D8\u5316</span>
            <span class="token comment">//\u63A5\u53D7\u4E00\u4E2A\u51FD\u6570\u6267\u884C \u83B7\u5F97\u65B0\u7684memo\u503C</span>
            <span class="token keyword">let</span> newMemo <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>newMemo<span class="token punctuation">,</span>dependencies<span class="token punctuation">]</span>
            <span class="token keyword">return</span> newMemo
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u8BF4\u660E\u662F\u7B2C\u4E00\u6B21\u6E32\u67D3</span>
        <span class="token keyword">let</span> newMemo <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>newMemo<span class="token punctuation">,</span>dependencies<span class="token punctuation">]</span>
        <span class="token keyword">return</span> newMemo
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u5FC5\u987B\u91CD\u7F6E\u4E3A0 \u5426\u5219hookIndex\u7684\u72B6\u6001\u4F1A\u4E00\u76F4\u7D2F\u52A0 \u627E\u4E0D\u5230\u7D22\u5F15\u9879</span>
    hookIndex <span class="token operator">=</span><span class="token number">0</span> 
    <span class="token comment">//\u6E32\u67D3react dom</span>
    ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElmentById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="useeffect" tabindex="-1">useEffect <a class="header-anchor" href="#useeffect" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> hookStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//\u4FDD\u5B58\u72B6\u6001\u7684\u6570\u7EC4</span>
<span class="token keyword">let</span> hookIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//\u72B6\u6001\u7D22\u5F15</span>
<span class="token keyword">function</span> <span class="token function">useEffect</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span>dependencies</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u8BF4\u660E\u4E0D\u662F\u7B2C\u4E00\u6B21  </span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> lastDependencies <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>
        <span class="token keyword">let</span> same <span class="token operator">=</span> dependencies<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>item<span class="token operator">===</span>lastDependencies<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span><span class="token punctuation">{</span>
            hookIndex<span class="token operator">++</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u53EA\u8981\u6709\u4E00\u4E2A\u53D8\u91CF\u4F9D\u8D56\u53D8\u5316</span>
            <span class="token comment">//\u6DFB\u52A0\u4E00\u4E2A\u5B8F\u4EFB\u52A1\uFF0C\u5728\u672C\u6B21\u6E32\u67D3\u4E4B\u540E\u6267\u884C</span>
            hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> dependencies
            <span class="token function">setTimeout</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u8BF4\u660E\u662F\u7B2C\u4E00\u6B21\u6E32\u67D3</span>
        hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> dependencies
        <span class="token function">setTimeout</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">// useEffect \u9500\u6BC1\u751F\u547D\u5468\u671F\u7684\u5199\u6CD5</span>
<span class="token keyword">function</span> <span class="token function">useEffect</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span>dependencies</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u8BF4\u660E\u4E0D\u662F\u7B2C\u4E00\u6B21  </span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">[</span>oldDestroy <span class="token punctuation">,</span>lastDependencies <span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>
        <span class="token keyword">let</span> same <span class="token operator">=</span> dependencies<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>item<span class="token operator">===</span>lastDependencies<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span><span class="token punctuation">{</span>
            hookIndex<span class="token operator">++</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u53EA\u8981\u6709\u4E00\u4E2A\u53D8\u91CF\u4F9D\u8D56\u53D8\u5316</span>
            <span class="token function">oldDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">//\u6DFB\u52A0\u4E00\u4E2A\u5B8F\u4EFB\u52A1\uFF0C\u5728\u672C\u6B21\u6E32\u67D3\u4E4B\u540E\u6267\u884C</span>
            <span class="token keyword">let</span> destroy <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>destroy<span class="token punctuation">,</span>dependencies<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u8BF4\u660E\u662F\u7B2C\u4E00\u6B21\u6E32\u67D3</span>
        <span class="token keyword">let</span> destroy <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>destroy<span class="token punctuation">,</span>dependencies<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u5FC5\u987B\u91CD\u7F6E\u4E3A0 \u5426\u5219hookIndex\u7684\u72B6\u6001\u4F1A\u4E00\u76F4\u7D2F\u52A0 \u627E\u4E0D\u5230\u7D22\u5F15\u9879</span>
    hookIndex <span class="token operator">=</span><span class="token number">0</span> 
    <span class="token comment">//\u6E32\u67D3react dom</span>
    ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElmentById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="uselayouteffect" tabindex="-1">useLayoutEffect <a class="header-anchor" href="#uselayouteffect" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> hookStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//\u4FDD\u5B58\u72B6\u6001\u7684\u6570\u7EC4</span>
<span class="token keyword">let</span> hookIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//\u72B6\u6001\u7D22\u5F15</span>
<span class="token keyword">function</span> <span class="token function">useLayoutEffect</span> <span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span>dependencies</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u8BF4\u660E\u4E0D\u662F\u7B2C\u4E00\u6B21  </span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> lastDependencies <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>
        <span class="token keyword">let</span> same <span class="token operator">=</span> dependencies<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>item<span class="token operator">===</span>lastDependencies<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>same<span class="token punctuation">)</span><span class="token punctuation">{</span>
            hookIndex<span class="token operator">++</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u53EA\u8981\u6709\u4E00\u4E2A\u53D8\u91CF\u4F9D\u8D56\u53D8\u5316</span>
            hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> dependencies
            <span class="token comment">//\u6DFB\u52A0\u4E00\u4E2A\u5FAE\u4EFB\u52A1\uFF0C\u5728\u672C\u6B21\u6E32\u67D3\u4E4B\u524D\u6267\u884C</span>
            <span class="token function">queueMicrotask</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">//\u8BF4\u660E\u662F\u7B2C\u4E00\u6B21\u6E32\u67D3</span>
        hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> dependencies
        <span class="token function">queueMicrotask</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//\u5FC5\u987B\u91CD\u7F6E\u4E3A0 \u5426\u5219hookIndex\u7684\u72B6\u6001\u4F1A\u4E00\u76F4\u7D2F\u52A0 \u627E\u4E0D\u5230\u7D22\u5F15\u9879</span>
    hookIndex <span class="token operator">=</span><span class="token number">0</span> 
    <span class="token comment">//\u6E32\u67D3react dom</span>
    ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App<span class="token operator">&gt;</span><span class="token punctuation">,</span>document<span class="token punctuation">.</span><span class="token function">getElmentById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="https://app.yinxiang.com/FileSharing.action?hash=1/4dc0611c1216575e2c734795ef3ddd7a-283887" alt="img"></p><h2 id="usecontext" tabindex="-1">useContext <a class="header-anchor" href="#usecontext" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> counterContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">useContext</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> context<span class="token punctuation">.</span>_currentValue
<span class="token punctuation">}</span>
<span class="token comment">//eg:</span>
<span class="token keyword">let</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span>setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>counterContext<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>CounterContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>state<span class="token punctuation">,</span>setState<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Counter<span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>CounterContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
</code></pre></div><h2 id="usereducer" tabindex="-1">useReducer <a class="header-anchor" href="#usereducer" aria-hidden="true">#</a></h2><div class="language-js"><pre><code><span class="token keyword">let</span> hookStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//\u4FDD\u5B58\u72B6\u6001\u7684\u6570\u7EC4</span>
<span class="token keyword">let</span> hookIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//\u72B6\u6001\u7D22\u5F15</span>
<span class="token keyword">function</span> <span class="token function">useReducer</span> <span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span>initialState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">||</span> initialState

    <span class="token keyword">let</span> currentIndex <span class="token operator">=</span> hookIndex 
    <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> reducer<span class="token operator">?</span><span class="token function">reducer</span><span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>action<span class="token punctuation">)</span><span class="token operator">:</span>action
        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span>dispatch<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div>`,16),e=[o];function c(u,l,k,i,r,d){return a(),s("div",null,e)}var f=n(p,[["render",c]]);export{h as __pageData,f as default};
